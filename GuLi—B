local Library = {}

function Library:CreateWindow(HubName)
	--// Services
	local UserInputService = game:GetService("UserInputService")
	local TweenService = game:GetService("TweenService")
	local RunService = game:GetService("RunService")
	local LocalPlayer = game.Players.LocalPlayer
	local Mouse = LocalPlayer:GetMouse()

	--// GUI Creation
	local retace = Instance.new("ScreenGui")
	local WaterMark = Instance.new("Frame")
	local WaterMark_2 = Instance.new("Frame")
	local UICorner = Instance.new("UICorner")
	local UIGradient = Instance.new("UIGradient")
	local TextLabel = Instance.new("TextLabel")
	local OpEn = Instance.new("Frame")
	local backraund = Instance.new("Frame")
	local UICorner_3 = Instance.new("UICorner")
	local OpenClose = Instance.new("TextButton")
	local UICorner_4 = Instance.new("UICorner")
	local UICorner_5 = Instance.new("UICorner")
	local UIGradient_2 = Instance.new("UIGradient")
	local TAB = Instance.new("Frame")
	local UICorner_6 = Instance.new("UICorner")
	local TABline = Instance.new("Frame")
	local UICorner_7 = Instance.new("UICorner")
	local TABline_2 = Instance.new("Frame")
	local UICorner_8 = Instance.new("UICorner")
	local Name = Instance.new("TextLabel")
	local MenuBackround = Instance.new("Frame")
	local UICorner_9 = Instance.new("UICorner")
	local Close = Instance.new("TextButton")
	local UICorner_10 = Instance.new("UICorner")
	local PageList = Instance.new("ScrollingFrame")
	local UICorner_11 = Instance.new("UICorner")
	local UIPageLayout = Instance.new("UIPageLayout")
	local bckMenu = Instance.new("Frame")
	local functionable1menu = Instance.new("Folder")
	local UIPageLayout_Content = Instance.new("UIPageLayout")
	local PAGEline = Instance.new("Frame")
	local UICorner_21 = Instance.new("UICorner")

	--// Properties
	retace.Name = "NymaUI"
	retace.Parent = game.Players.LocalPlayer:WaitForChild("PlayerGui")
	retace.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
	retace.DisplayOrder = 100
	retace.ResetOnSpawn = false

	-- Watermark
	WaterMark.Name = "WaterMark"
	WaterMark.Parent = retace
	WaterMark.BackgroundColor3 = Color3.fromRGB(28, 28, 28)
	WaterMark.BackgroundTransparency = 0.340
	WaterMark.Position = UDim2.new(0.008, 0, 0.012, 0)
	WaterMark.Size = UDim2.new(0, 103, 0, 18)
	
	WaterMark_2.Parent = WaterMark
	WaterMark_2.BackgroundColor3 = Color3.fromRGB(157, 76, 255)
	WaterMark_2.BackgroundTransparency = 0.090
	WaterMark_2.Position = UDim2.new(-0.012, 0, 0.012, 0)
	WaterMark_2.Size = UDim2.new(0, 8, 0, 25)
	UICorner.CornerRadius = UDim.new(0, 4)
	UICorner.Parent = WaterMark_2
	
	UIGradient.Color = ColorSequence.new{ColorSequenceKeypoint.new(0, Color3.fromRGB(200, 1, 255)), ColorSequenceKeypoint.new(1, Color3.fromRGB(81, 45, 190))}
	UIGradient.Rotation = 90
	UIGradient.Parent = WaterMark_2

	TextLabel.Parent = WaterMark
	TextLabel.BackgroundTransparency = 1
	TextLabel.Size = UDim2.new(0, 103, 0, 17)
	TextLabel.Font = Enum.Font.SourceSansBold
	TextLabel.Text = HubName or "Nyma | PREMIUM"
	TextLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
	TextLabel.TextSize = 14
	TextLabel.TextTransparency = 0.260
	UICorner_2.CornerRadius = UDim.new(0, 4)
	UICorner_2.Parent = WaterMark

	-- Open/Close Button (Small Square)
	OpEn.Name = "OpEn"
	OpEn.Parent = retace
	OpEn.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
	OpEn.Position = UDim2.new(0.48, 0, 0.02, 0) -- Center top for mobile
	OpEn.Size = UDim2.new(0, 40, 0, 31)
	UICorner_5.CornerRadius = UDim.new(0, 4)
	UICorner_5.Parent = OpEn
	UIGradient_2.Color = ColorSequence.new{ColorSequenceKeypoint.new(0, Color3.fromRGB(170, 0, 255)), ColorSequenceKeypoint.new(1, Color3.fromRGB(43, 13, 104))}
	UIGradient_2.Rotation = 36
	UIGradient_2.Parent = OpEn

	backraund.Name = "backraund"
	backraund.Parent = OpEn
	backraund.BackgroundColor3 = Color3.fromRGB(26, 26, 26)
	backraund.ClipsDescendants = true
	backraund.Position = UDim2.new(0.16, 0, 0.07, 0)
	backraund.Size = UDim2.new(0, 26, 0, 26)
	UICorner_3.CornerRadius = UDim.new(0, 4)
	UICorner_3.Parent = backraund

	OpenClose.Name = "OpenClose"
	OpenClose.Parent = backraund
	OpenClose.BackgroundTransparency = 1
	OpenClose.Size = UDim2.new(1, 0, 1, 0)
	OpenClose.Font = Enum.Font.GothamBold
	OpenClose.Text = "UI"
	OpenClose.TextColor3 = Color3.fromRGB(255, 255, 255)
	OpenClose.TextSize = 12
	UICorner_4.CornerRadius = UDim.new(0, 4)
	UICorner_4.Parent = OpenClose

	-- Main TAB Frame
	TAB.Name = "TAB"
	TAB.Parent = retace
	TAB.BackgroundColor3 = Color3.fromRGB(31, 31, 31)
	TAB.Position = UDim2.new(0.5, -284, 0.5, -162) -- Center screen
	TAB.Size = UDim2.new(0, 568, 0, 24)
	UICorner_6.CornerRadius = UDim.new(0, 4)
	UICorner_6.Parent = TAB

	-- Draggable Logic (Mobile Friendly)
	local dragging, dragInput, dragStart, startPos
	local function Update(input)
		local delta = input.Position - dragStart
		TAB.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
	end
	TAB.InputBegan:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
			dragging = true
			dragStart = input.Position
			startPos = TAB.Position
			input.Changed:Connect(function()
				if input.UserInputState == Enum.UserInputState.End then dragging = false end
			end)
		end
	end)
	TAB.InputChanged:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
			dragInput = input
		end
	end)
	UserInputService.InputChanged:Connect(function(input)
		if dragging and input == dragInput then Update(input) end
	end)

	-- Decor Lines
	TABline.Parent = TAB
	TABline.BackgroundColor3 = Color3.fromRGB(82, 255, 177)
	TABline.Position = UDim2.new(0, 0, 1, 0)
	TABline.Size = UDim2.new(1, 0, 0, 1)
	TABline.ZIndex = 2
	UICorner_7.Parent = TABline

	TABline_2.Parent = TAB
	TABline_2.BackgroundColor3 = Color3.fromRGB(46, 46, 46)
	TABline_2.Position = UDim2.new(0, 0, 1, 21)
	TABline_2.Size = UDim2.new(1, 0, 0, 1)
	TABline_2.ZIndex = 99
	UICorner_8.Parent = TABline_2

	Name.Parent = TAB
	Name.BackgroundTransparency = 1
	Name.Position = UDim2.new(0.04, 0, 0.2, 0)
	Name.Size = UDim2.new(0, 153, 0, 19)
	Name.ZIndex = 999
	Name.Font = Enum.Font.SourceSans
	Name.Text = HubName or "Nyma"
	Name.TextColor3 = Color3.fromRGB(255, 255, 255)
	Name.TextScaled = true
	Name.TextSize = 14

	-- Menu Background
	MenuBackround.Parent = TAB
	MenuBackround.BackgroundColor3 = Color3.fromRGB(18, 18, 18)
	MenuBackround.ClipsDescendants = true
	MenuBackround.Position = UDim2.new(0, 0, 1, 0)
	MenuBackround.Size = UDim2.new(1, 0, 13.5, 0) -- 324px height approx
	UICorner_9.CornerRadius = UDim.new(0, 5)
	UICorner_9.Parent = MenuBackround

	-- Close Button
	Close.Name = "Close"
	Close.Parent = MenuBackround
	Close.BackgroundTransparency = 1
	Close.Position = UDim2.new(0.005, 0, 0.02, 0)
	Close.Size = UDim2.new(0, 26, 0, 20)
	Close.ZIndex = 999
	Close.Font = Enum.Font.GothamBold
	Close.Text = "X"
	Close.TextColor3 = Color3.fromRGB(135, 8, 213)
	Close.TextSize = 17
	UICorner_10.Parent = Close

	-- Page List (Left Side)
	PageList.Parent = MenuBackround
	PageList.BackgroundColor3 = Color3.fromRGB(19, 19, 19)
	PageList.Position = UDim2.new(0, 0, 0.1, 0)
	PageList.Size = UDim2.new(0, 100, 0, 288)
	PageList.ZIndex = 22
	PageList.ScrollBarThickness = 0
	UICorner_11.CornerRadius = UDim.new(0, 5)
	UICorner_11.Parent = PageList
	
	UIPageLayout.Parent = PageList
	UIPageLayout.FillDirection = Enum.FillDirection.Vertical
	UIPageLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center
	UIPageLayout.SortOrder = Enum.SortOrder.LayoutOrder
	UIPageLayout.Padding = UDim.new(0, 5)

	-- Main Content Area (The "Features Menu" holder)
	bckMenu.Name = "bckMenu"
	bckMenu.Parent = MenuBackround
	bckMenu.BackgroundTransparency = 1
	bckMenu.Position = UDim2.new(0.188, 0, 0.077, 0)
	bckMenu.Size = UDim2.new(0.8, 0, 0.9, 0)
	bckMenu.ZIndex = 999

	functionable1menu.Name = "functionable1menu"
	functionable1menu.Parent = bckMenu

	UIPageLayout_Content.Parent = functionable1menu
	UIPageLayout_Content.SortOrder = Enum.SortOrder.LayoutOrder
	UIPageLayout_Content.EasingDirection = Enum.EasingDirection.In
	UIPageLayout_Content.TweenTime = 0.5

	-- Vertical Divider Line
	PAGEline.Parent = TAB
	PAGEline.BackgroundColor3 = Color3.fromRGB(46, 46, 46)
	PAGEline.Position = UDim2.new(0.17, 0, 7, 0) -- Adjusted
	PAGEline.Size = UDim2.new(0, 1, 0, 300)
	PAGEline.ZIndex = 999
	UICorner_21.Parent = PAGEline

	--// Logic: Open/Close
	local UIHidden = false
	OpenClose.MouseButton1Click:Connect(function()
		UIHidden = not UIHidden
		TAB.Visible = not UIHidden
	end)
	Close.MouseButton1Click:Connect(function()
		retace:Destroy()
	end)

	--// Library Logic
	local Window = {}

	function Window:Tab(TabName)
		-- 1. Left Side Button
		local BorderBtn = Instance.new("Frame")
		local Btn = Instance.new("TextButton")
		
		BorderBtn.Parent = PageList
		BorderBtn.BackgroundColor3 = Color3.fromRGB(29, 29, 29)
		BorderBtn.Size = UDim2.new(0, 93, 0, 27)
		BorderBtn.ZIndex = 93
		Instance.new("UICorner", BorderBtn).CornerRadius = UDim.new(0, 4)

		Btn.Parent = BorderBtn
		Btn.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
		Btn.Position = UDim2.new(0.01, 0, 0.05, 0)
		Btn.Size = UDim2.new(0.98, 0, 0.9, 0)
		Btn.ZIndex = 95
		Btn.Font = Enum.Font.SourceSans
		Btn.Text = TabName
		Btn.TextColor3 = Color3.fromRGB(255, 255, 255)
		Btn.TextSize = 14
		Instance.new("UICorner", Btn).CornerRadius = UDim.new(0, 4)

		-- 2. The "Features Menu" (Replicating your Menu structure)
		-- Это и есть твой "Main", куда складываются функции
		local MenuContainer = Instance.new("ScrollingFrame")
		local MenuList = Instance.new("UIListLayout")
		
		MenuContainer.Name = TabName.."_Menu"
		MenuContainer.Parent = functionable1menu
		MenuContainer.BackgroundColor3 = Color3.fromRGB(20, 20, 20) -- Цвет как у твоих features menu
		MenuContainer.Size = UDim2.new(1, 0, 1, 0) -- На весь bckMenu
		MenuContainer.ScrollBarThickness = 0
		MenuContainer.BorderSizePixel = 0
		Instance.new("UICorner", MenuContainer).CornerRadius = UDim.new(0, 5)

		MenuList.Parent = MenuContainer
		MenuList.SortOrder = Enum.SortOrder.LayoutOrder
		MenuList.Padding = UDim.new(0, 5)
		MenuList.HorizontalAlignment = Enum.HorizontalAlignment.Center

		-- Switching Logic
		Btn.MouseButton1Click:Connect(function()
			UIPageLayout_Content:JumpTo(MenuContainer)
			-- Reset colors
			for _, v in pairs(PageList:GetChildren()) do
				if v:IsA("Frame") and v:FindFirstChild("TextButton") then
					v.TextButton.TextColor3 = Color3.fromRGB(255, 255, 255)
				end
			end
			Btn.TextColor3 = Color3.fromRGB(157, 76, 255)
		end)

		local TabFuncs = {}

		function TabFuncs:Button(text, callback)
			local ButtonFrame = Instance.new("TextButton")
			ButtonFrame.Parent = MenuContainer
			ButtonFrame.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
			ButtonFrame.Size = UDim2.new(0.95, 0, 0, 30) -- Побольше для пальца
			ButtonFrame.Text = text
			ButtonFrame.TextColor3 = Color3.fromRGB(255, 255, 255)
			ButtonFrame.Font = Enum.Font.SourceSans
			ButtonFrame.TextSize = 14
			Instance.new("UICorner", ButtonFrame).CornerRadius = UDim.new(0, 3)

			ButtonFrame.MouseButton1Click:Connect(function()
				pcall(callback)
				TweenService:Create(ButtonFrame, TweenInfo.new(0.1), {BackgroundColor3 = Color3.fromRGB(60, 60, 60)}):Play()
				wait(0.1)
				TweenService:Create(ButtonFrame, TweenInfo.new(0.1), {BackgroundColor3 = Color3.fromRGB(35, 35, 35)}):Play()
			end)
		end

		function TabFuncs:Toggle(text, default, callback)
			local CheckBox = Instance.new("Frame")
			local CheckBoxBtn = Instance.new("TextButton")
			local FuncName = Instance.new("TextLabel")
			local Toggled = default or false

			CheckBox.Parent = MenuContainer
			CheckBox.BackgroundColor3 = Color3.fromRGB(49, 49, 49)
			CheckBox.Size = UDim2.new(0.95, 0, 0, 30)
			Instance.new("UICorner", CheckBox).CornerRadius = UDim.new(0, 4)

			CheckBoxBtn.Parent = CheckBox
			CheckBoxBtn.BackgroundColor3 = Toggled and Color3.fromRGB(157, 76, 255) or Color3.fromRGB(35, 35, 35)
			CheckBoxBtn.Position = UDim2.new(0.03, 0, 0.15, 0)
			CheckBoxBtn.Size = UDim2.new(0, 20, 0, 20)
			CheckBoxBtn.Text = ""
			Instance.new("UICorner", CheckBoxBtn).CornerRadius = UDim.new(0.3, 0)

			FuncName.Parent = CheckBox
			FuncName.BackgroundTransparency = 1
			FuncName.Position = UDim2.new(0.15, 0, 0, 0)
			FuncName.Size = UDim2.new(0.8, 0, 1, 0)
			FuncName.Font = Enum.Font.SourceSans
			FuncName.Text = text
			FuncName.TextColor3 = Color3.fromRGB(255, 255, 255)
			FuncName.TextSize = 14
			FuncName.TextXAlignment = Enum.TextXAlignment.Left

			local function Update()
				Toggled = not Toggled
				local targetColor = Toggled and Color3.fromRGB(157, 76, 255) or Color3.fromRGB(35, 35, 35)
				TweenService:Create(CheckBoxBtn, TweenInfo.new(0.2), {BackgroundColor3 = targetColor}):Play()
				pcall(callback, Toggled)
			end

			CheckBoxBtn.MouseButton1Click:Connect(Update)
			-- Invisible button to make clicking easier on mobile
			local InvBtn = Instance.new("TextButton")
			InvBtn.Parent = CheckBox
			InvBtn.BackgroundTransparency = 1
			InvBtn.Size = UDim2.new(1,0,1,0)
			InvBtn.Text = ""
			InvBtn.ZIndex = 5
			InvBtn.MouseButton1Click:Connect(Update)
		end

		function TabFuncs:Slider(text, min, max, default, callback)
			local SliderFrame = Instance.new("Frame")
			local Label = Instance.new("TextLabel")
			local ValLabel = Instance.new("TextLabel")
			local Bar = Instance.new("Frame")
			local Fill = Instance.new("Frame")
			local TouchZone = Instance.new("TextButton") -- For mobile touch

			SliderFrame.Parent = MenuContainer
			SliderFrame.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
			SliderFrame.Size = UDim2.new(0.95, 0, 0, 45)
			Instance.new("UICorner", SliderFrame).CornerRadius = UDim.new(0, 4)

			Label.Parent = SliderFrame
			Label.BackgroundTransparency = 1
			Label.Position = UDim2.new(0.05, 0, 0.1, 0)
			Label.Size = UDim2.new(0.5, 0, 0, 15)
			Label.Font = Enum.Font.SourceSans
			Label.Text = text
			Label.TextColor3 = Color3.fromRGB(255, 255, 255)
			Label.TextSize = 14
			Label.TextXAlignment = Enum.TextXAlignment.Left

			ValLabel.Parent = SliderFrame
			ValLabel.BackgroundTransparency = 1
			ValLabel.Position = UDim2.new(0.7, 0, 0.1, 0)
			ValLabel.Size = UDim2.new(0.25, 0, 0, 15)
			ValLabel.Font = Enum.Font.SourceSans
			ValLabel.Text = tostring(default)
			ValLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
			ValLabel.TextSize = 14
			ValLabel.TextXAlignment = Enum.TextXAlignment.Right

			Bar.Parent = SliderFrame
			Bar.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
			Bar.Position = UDim2.new(0.05, 0, 0.6, 0)
			Bar.Size = UDim2.new(0.9, 0, 0, 10) -- Thick enough for mobile
			Instance.new("UICorner", Bar).CornerRadius = UDim.new(1, 0)

			Fill.Parent = Bar
			Fill.BackgroundColor3 = Color3.fromRGB(157, 76, 255)
			Fill.Size = UDim2.new((default - min) / (max - min), 0, 1, 0)
			Instance.new("UICorner", Fill).CornerRadius = UDim.new(1, 0)

			TouchZone.Parent = Bar
			TouchZone.BackgroundTransparency = 1
			TouchZone.Size = UDim2.new(1, 0, 1, 0)
			TouchZone.Text = ""

			local dragging = false
			local function Move(input)
				local pos = input.Position.X
				local percent = math.clamp((pos - Bar.AbsolutePosition.X) / Bar.AbsoluteSize.X, 0, 1)
				local value = math.floor(min + (max - min) * percent)
				Fill.Size = UDim2.new(percent, 0, 1, 0)
				ValLabel.Text = tostring(value)
				pcall(callback, value)
			end

			TouchZone.InputBegan:Connect(function(input)
				if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
					dragging = true
					Move(input)
				end
			end)
			TouchZone.InputEnded:Connect(function(input)
				if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
					dragging = false
				end
			end)
			UserInputService.InputChanged:Connect(function(input)
				if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
					Move(input)
				end
			end)
		end

		return TabFuncs
	end

	return Window
end

-- // ПРИМЕР ИСПОЛЬЗОВАНИЯ (Копируй это вниз) // --
-- Создаем библиотеку
local Library = Library:CreateWindow("Nyma Premium Mobile")

-- 1. Создаем вкладки (Они же создают твои меню-контейнеры)
local MainTab = Library:Tab("Main")
local VisualsTab = Library:Tab("Visuals")

-- 2. Добавляем функции
MainTab:Toggle("Auto Farm", false, function(state)
	print("AutoFarm:", state)
end)

MainTab:Slider("WalkSpeed", 16, 200, 16, function(val)
	if game.Players.LocalPlayer.Character then
		game.Players.LocalPlayer.Character.Humanoid.WalkSpeed = val
	end
end)

MainTab:Button("Fly Script", function()
	print("Fly Activated")
end)

VisualsTab:Toggle("ESP", true, function(s)
	print("ESP is", s)
end)
